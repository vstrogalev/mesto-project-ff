(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-1",headers:{authorization:"ac3450cb-5c4e-4a3e-9264-27166909578b","Content-Type":"application/json"}},t=function(t,n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"".concat(n?"PUT":"DELETE"),headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка лайка карточки: ".concat(e.status))}))},n=function(e){return fetch(e,{method:"HEAD"}).then((function(e){return e.ok?"image/jpg"===e.headers.get("Content-Type"):Promise.reject("Ошибка проверки ссылки аватара: ".concat(e.status))})).catch((function(){return Promise.reject("Ошибка проверки типа ссылки аватара")}))},o=document.querySelector("#card-template").content;function r(e,t,n,o,r){var a=c(),i=a.querySelector(".card__image");i.src=e.link,i.alt=e.name;var s=a.querySelector(".card");a.querySelector(".card__title").textContent=e.name,a.querySelector(".card__like-counter").textContent=e.likes.length,u(e,r)?(s.dataset.liked=!0,s.querySelector(".card__like-button").classList.add("card__like-button_is-active")):s.dataset.liked=!1,s.dataset.id=e._id;var l=a.querySelector(".card__delete-button");return e.owner._id===r?l.addEventListener("click",(function(e){return t(e)})):l.classList.add("card__delete-button_inactive"),a.querySelector(".card__like-button").addEventListener("click",n),a.querySelector(".card__image").addEventListener("click",(function(){return o(e)})),a}function c(){return o.cloneNode(!0)}function a(e){var n=e.target,o=n.closest(".card"),r=o.dataset.id;"false"===o.dataset.liked?t(r,!0).then((function(e){o.querySelector(".card__like-counter").textContent=e.likes.length,o.dataset.liked=!0,n.classList.add("card__like-button_is-active")})):t(r,!1).then((function(e){o.querySelector(".card__like-counter").textContent=e.likes.length,o.dataset.liked=!1,n.classList.remove("card__like-button_is-active")}))}var u=function(e,t){return e.likes.some((function(e){return e._id===t}))};function i(e){e.classList.add("popup_is-animated"),setTimeout((function(){e.classList.add("popup_is-opened")}),0),e.addEventListener("click",s),document.addEventListener("keydown",l)}function s(e){var t=document.querySelector(".popup_is-opened");e.target===t&&d(t)}function l(e){"Escape"===e.key&&d(document.querySelector(".popup_is-opened"))}function d(e){e.classList.remove("popup_is-opened"),setTimeout((function(){e.classList.remove("popup_is-animated")}),600),e.removeEventListener("click",s),document.removeEventListener("keydown",l)}function p(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){f(e,n,t)})),m(n,o,t.inactiveButtonClass)}function _(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));r.textContent=n,r.classList.add(o.errorClass)}function f(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));o.classList.remove(n.errorClass),o.textContent=""}function m(e,t,n){e.some((function(e){return!e.validity.valid}))?t.classList.add(n):t.classList.remove(n)}var v,y=document.querySelector(".places__list"),S=[];Promise.all([fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка получения инфо пользователя: ".concat(e.status))})),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка загрузки массива карточек: ".concat(e.status))}))]).then((function(e){S=e[1],document.querySelector(".profile__image").style.backgroundImage="url(".concat(e[0].avatar,")"),document.querySelector(".profile__title").textContent=e[0].name,document.querySelector(".profile__description").textContent=e[0].about,function(e){S.forEach((function(t){y.append(r(t,V,a,J,e))}))}(v=e[0]._id)}));var h={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()}));var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);m(n,o,e.inactiveButtonClass),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?f(e,t,n):_(e,t,t.validationMessage,n)}(t,r,e),m(n,o,e.inactiveButtonClass)}))}))}))}(h);var q=document.querySelector(".profile__image"),k=document.querySelector(".popup_type_avatar"),b=k.querySelector("form"),L=b.querySelector(".popup__input_type_url");b.addEventListener("submit",(function(t){t.preventDefault(),C.textContent="Сохранение...",n(L.value).then((function(){var t;(t=L.value,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка загрузки аватара: ".concat(e.status))}))).then((function(e){d(k),C.textContent="Сохранить",q.style.backgroundImage="url(".concat(e.avatar,")"),b.reset()}))})).catch((function(){C.textContent="Сохранить",_(b,L,"Введите URL картинки",h)}))}));var C=b.querySelector(".popup__button");z(k),q.addEventListener("click",(function(){i(k),p(k,h)})),document.querySelector(".profile__edit-button").addEventListener("click",(function(){i(E),P.value=x.textContent,U.value=j.textContent,p(E,h)}));var E=document.querySelector(".popup.popup_type_edit"),g=E.querySelector("form"),x=document.querySelector(".profile__title"),j=document.querySelector(".profile__description"),P=g.querySelector(".popup__input_type_name"),U=g.querySelector(".popup__input_type_description");g.addEventListener("submit",(function(t){var n,o;t.preventDefault(),x.textContent=P.value,j.textContent=U.value,(n=P.value,o=U.value,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:n,about:o})})).then((function(e){e.ok||console.error(e)})),d(E)})),z(E);var T=document.querySelector(".profile__add-button"),A=document.querySelector(".popup.popup_type_new-card"),B=A.querySelector("form"),D=B.querySelector(".popup__input_type_card-name"),w=B.querySelector(".popup__input_type_url");B.addEventListener("submit",(function(t){t.preventDefault(),I.textContent="Сохранение...",n(w.value).then((function(){var t,n,o;(t={name:D.value,link:w.value},n=t.name,o=t.link,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:n,link:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка загрузки карточки: ".concat(e.status))}))).then((function(e){d(A),I.textContent="Сохранить",y.prepend(r(e,V,a,J,v)),B.reset()}))})).catch((function(){_(B,w,"Введите URL картинки",h)}))}));var I=B.querySelector(".popup__button");z(A),T.addEventListener("click",(function(){D.value="",w.value="",i(A),p(A,h)}));var N=document.querySelector(".popup.popup_type_image"),O=N.querySelector(".popup__image"),H=N.querySelector(".popup__caption");function J(e){O.src=e.link,O.alt=e.name,H.textContent=e.name,i(N)}z(N);var M=document.querySelector(".popup.popup_type_delete-card");z(M),M.addEventListener("submit",(function(t){var n,o;n=t.target.querySelector(".popup__button").dataset.cardId,(o=n,fetch("".concat(e.baseUrl,"/cards/").concat(o),{method:"DELETE",headers:e.headers})).then((function(e){e.ok?(console.log(e.json()),document.querySelector('.card[data-id="'.concat(n,'"]')).remove()):console.log("Ошибка удаления карточки: ".concat(e.status))})).catch((function(e){console.log("Ошибка удаления карточки: ".concat(e))})),d(M)}));var R=M.querySelector(".popup__button");function V(e){var t=e.target.closest(".card").dataset.id;R.dataset.cardId=t,i(M)}function z(e){e.querySelector(".popup__close").addEventListener("click",(function(){d(e)}))}})();