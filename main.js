(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-1",headers:{authorization:"ac3450cb-5c4e-4a3e-9264-27166909578b","Content-Type":"application/json"}},t=function(t,o){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"".concat(o?"PUT":"DELETE"),headers:e.headers}).then(n)};function n(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var o=document.querySelector("#card-template").content;function r(e,t,n,o,r){var a=c(),u=a.querySelector(".card__image");u.src=e.link,u.alt=e.name;var i=a.querySelector(".card");a.querySelector(".card__title").textContent=e.name,a.querySelector(".card__like-counter").textContent=e.likes.length,e.likes.some((function(e){return e._id===r}))&&i.querySelector(".card__like-button").classList.add("card__like-button_is-active");var l=a.querySelector(".card__like-button");l.addEventListener("click",(function(){return n(e._id,l)}));var s=a.querySelector(".card__delete-button");return e.owner._id===r?s.addEventListener("click",(function(){return t(e,s)})):s.classList.add("card__delete-button_inactive"),a.querySelector(".card__image").addEventListener("click",(function(){return o(e)})),a}function c(){return o.cloneNode(!0)}function a(e,n){var o=n.closest(".card");n.classList.contains("card__like-button_is-active")?t(e,!1).then((function(e){o.querySelector(".card__like-counter").textContent=e.likes.length,n.classList.remove("card__like-button_is-active")})).catch((function(e){console.log("Ошибка дизлайка карточки: ".concat(e))})):t(e,!0).then((function(e){o.querySelector(".card__like-counter").textContent=e.likes.length,n.classList.add("card__like-button_is-active")})).catch((function(e){console.log("Ошибка лайка карточки: ".concat(e))}))}function u(e){e.classList.add("popup_is-animated"),setTimeout((function(){e.classList.add("popup_is-opened")}),0),e.addEventListener("click",i),document.addEventListener("keydown",l)}function i(e){e.target===e.currentTarget&&s(e.currentTarget)}function l(e){"Escape"===e.key&&s(document.querySelector(".popup_is-opened"))}function s(e){e.classList.remove("popup_is-opened"),setTimeout((function(){e.classList.remove("popup_is-animated")}),600),e.removeEventListener("click",i),document.removeEventListener("keydown",l)}function d(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){_(e,n,t)})),f(n,o,t.inactiveButtonClass)}function p(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));r.textContent=n,r.classList.add(o.errorClass)}function _(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));o.classList.remove(n.errorClass),o.textContent=""}function f(e,t,n){e.some((function(e){return!e.validity.valid}))?(t.classList.add(n),t.setAttribute("disabled","disabled")):(t.classList.remove(n),t.removeAttribute("disabled"))}var v,m=document.querySelector(".places__list"),y=document.querySelector(".profile__image"),h=document.querySelector(".profile__title"),S=document.querySelector(".profile__description");Promise.all([fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then(n),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then(n)]).then((function(e){y.style.backgroundImage="url(".concat(e[0].avatar,")"),h.textContent=e[0].name,S.textContent=e[0].about,function(e,t){t.forEach((function(t){m.append(r(t,V,a,H,e))}))}(v=e[0]._id,e[1])})).catch((function(e){return console.log("Ошибка загрузки данных (карточки и профиль) с сервера ".concat(e))}));var b={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);f(n,o,e.inactiveButtonClass),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?_(e,t,n):p(e,t,t.validationMessage,n)}(t,r,e),f(n,o,e.inactiveButtonClass)}))}))}))}(b);var q=document.querySelector(".profile__image"),k=document.querySelector(".popup_type_avatar"),C=k.querySelector("form"),L=C.querySelector(".popup__input_type_url");C.addEventListener("submit",(function(t){var o;t.preventDefault(),E.textContent="Сохранение...",(o=L.value,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:o})}).then(n)).then((function(e){s(k),q.style.backgroundImage="url(".concat(e.avatar,")"),C.reset()})).catch((function(){p(C,L,"Введите URL картинки",b)})).finally((function(){E.textContent="Сохранить"}))}));var E=C.querySelector(".popup__button");z(k),q.addEventListener("click",(function(){u(k),d(k,b)})),document.querySelector(".profile__edit-button").addEventListener("click",(function(){u(g),T.value=h.textContent,A.value=S.textContent,d(g,b)}));var g=document.querySelector(".popup.popup_type_edit"),x=g.querySelector("form"),T=x.querySelector(".popup__input_type_name"),A=x.querySelector(".popup__input_type_description");x.addEventListener("submit",(function(t){var o,r;t.preventDefault(),(o=T.value,r=A.value,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:o,about:r})}).then(n)).then((function(){U.textContent="Сохранение...",h.textContent=T.value,S.textContent=A.value,s(g)})).catch((function(e){return console.log("Ошибка сохранения данных профиля ".concat(e))})).finally((function(){U.textContent="Сохранить"}))})),z(g);var U=x.querySelector(".popup__button"),B=document.querySelector(".profile__add-button"),D=document.querySelector(".popup.popup_type_new-card"),P=D.querySelector("form"),w=P.querySelector(".popup__input_type_card-name"),N=P.querySelector(".popup__input_type_url");P.addEventListener("submit",(function(t){var o,c,u;t.preventDefault(),O.textContent="Сохранение...",(o={name:w.value,link:N.value},c=o.name,u=o.link,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:c,link:u})}).then(n)).then((function(e){s(D),m.prepend(r(e,V,a,H,v)),P.reset()})).catch((function(e){return console.log("Ошибка при сохранении карточки на сервере ".concat(e))})).finally((function(){O.textContent="Сохранить"}))}));var O=P.querySelector(".popup__button");z(D),B.addEventListener("click",(function(){w.value="",N.value="",u(D),d(D,b)}));var j=document.querySelector(".popup.popup_type_image"),J=j.querySelector(".popup__image"),M=j.querySelector(".popup__caption");function H(e){J.src=e.link,J.alt=e.name,M.textContent=e.name,u(j)}z(j);var I=document.querySelector(".popup.popup_type_delete-card");function V(t,o){I.addEventListener("submit",(function(r){var c;r.preventDefault(),(c=t._id,fetch("".concat(e.baseUrl,"/cards/").concat(c),{method:"DELETE",headers:e.headers}).then(n)).then((function(){o.closest(".card").remove(),s(I)})).catch((function(e){console.log("Ошибка удаления карточки: ".concat(e))}))})),u(I)}function z(e){e.querySelector(".popup__close").addEventListener("click",(function(){s(e)}))}z(I)})();