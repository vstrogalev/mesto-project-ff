(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-1",headers:{authorization:"ac3450cb-5c4e-4a3e-9264-27166909578b","Content-Type":"application/json"}},t=function(t,o){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"".concat(o?"PUT":"DELETE"),headers:e.headers}).then(n)};function n(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var o=document.querySelector("#card-template").content,r={};function c(e,t,n,o,c){var u=a(),i=u.querySelector(".card__image");i.src=e.link,i.alt=e.name;var l=u.querySelector(".card");u.querySelector(".card__title").textContent=e.name,u.querySelector(".card__like-counter").textContent=e.likes.length,e.likes.some((function(e){return e._id===c}))&&l.querySelector(".card__like-button").classList.add("card__like-button_is-active");var s=u.querySelector(".card__like-button");s.addEventListener("click",(function(){return n(e._id,s)}));var d=u.querySelector(".card__delete-button");return e.owner._id===c?d.addEventListener("click",(function(n){r.id=e._id,r.nodeDeleteBtn=d,t(n)})):d.classList.add("card__delete-button_inactive"),u.querySelector(".card__image").addEventListener("click",(function(){return o(e)})),u}function a(){return o.cloneNode(!0)}function u(e,n){var o=n.closest(".card");n.classList.contains("card__like-button_is-active")?t(e,!1).then((function(e){o.querySelector(".card__like-counter").textContent=e.likes.length,n.classList.remove("card__like-button_is-active")})).catch((function(e){console.log("Ошибка дизлайка карточки: ".concat(e))})):t(e,!0).then((function(e){o.querySelector(".card__like-counter").textContent=e.likes.length,n.classList.add("card__like-button_is-active")})).catch((function(e){console.log("Ошибка лайка карточки: ".concat(e))}))}function i(e){e.classList.add("popup_is-animated"),setTimeout((function(){e.classList.add("popup_is-opened")}),0),e.addEventListener("click",l),document.addEventListener("keydown",s)}function l(e){e.target===e.currentTarget&&d(e.currentTarget)}function s(e){"Escape"===e.key&&d(document.querySelector(".popup_is-opened"))}function d(e){e.classList.remove("popup_is-opened"),setTimeout((function(){e.classList.remove("popup_is-animated")}),600),e.removeEventListener("click",l),document.removeEventListener("keydown",s)}function p(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){f(e,n,t)})),v(n,o,t.inactiveButtonClass)}function _(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));r.textContent=n,r.classList.add(o.errorClass)}function f(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));o.classList.remove(n.errorClass),o.textContent=""}function v(e,t,n){e.some((function(e){return!e.validity.valid}))?(t.classList.add(n),t.setAttribute("disabled","disabled")):(t.classList.remove(n),t.removeAttribute("disabled"))}var m,y=document.querySelector(".places__list"),h=document.querySelector(".profile__image"),S=document.querySelector(".profile__title"),b=document.querySelector(".profile__description");Promise.all([fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then(n),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then(n)]).then((function(e){h.style.backgroundImage="url(".concat(e[0].avatar,")"),S.textContent=e[0].name,b.textContent=e[0].about,function(e,t){t.forEach((function(t){y.append(c(t,z,u,I,e))}))}(m=e[0]._id,e[1])})).catch((function(e){return console.log("Ошибка загрузки данных (карточки и профиль) с сервера ".concat(e))}));var q={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);v(n,o,e.inactiveButtonClass),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?f(e,t,n):_(e,t,t.validationMessage,n)}(t,r,e),v(n,o,e.inactiveButtonClass)}))}))}))}(q);var k=document.querySelector(".profile__image"),C=document.querySelector(".popup_type_avatar"),L=C.querySelector("form"),E=L.querySelector(".popup__input_type_url");L.addEventListener("submit",(function(t){var o;t.preventDefault(),g.textContent="Сохранение...",(o=E.value,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:o})}).then(n)).then((function(e){d(C),k.style.backgroundImage="url(".concat(e.avatar,")"),L.reset()})).catch((function(){_(L,E,"Введите URL картинки",q)})).finally((function(){g.textContent="Сохранить"}))}));var g=L.querySelector(".popup__button");R(C),k.addEventListener("click",(function(){i(C),p(C,q)})),document.querySelector(".profile__edit-button").addEventListener("click",(function(){i(x),A.value=S.textContent,U.value=b.textContent,p(x,q)}));var x=document.querySelector(".popup.popup_type_edit"),T=x.querySelector("form"),A=T.querySelector(".popup__input_type_name"),U=T.querySelector(".popup__input_type_description");T.addEventListener("submit",(function(t){var o,r;t.preventDefault(),B.textContent="Сохранение...",(o=A.value,r=U.value,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:o,about:r})}).then(n)).then((function(){S.textContent=A.value,b.textContent=U.value,d(x)})).catch((function(e){return console.log("Ошибка сохранения данных профиля ".concat(e))})).finally((function(){B.textContent="Сохранить"}))})),R(x);var B=T.querySelector(".popup__button"),D=document.querySelector(".profile__add-button"),P=document.querySelector(".popup.popup_type_new-card"),w=P.querySelector("form"),N=w.querySelector(".popup__input_type_card-name"),O=w.querySelector(".popup__input_type_url");w.addEventListener("submit",(function(t){var o,r,a;t.preventDefault(),j.textContent="Сохранение...",(o={name:N.value,link:O.value},r=o.name,a=o.link,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:r,link:a})}).then(n)).then((function(e){d(P),y.prepend(c(e,z,u,I,m)),w.reset()})).catch((function(e){return console.log("Ошибка при сохранении карточки на сервере ".concat(e))})).finally((function(){j.textContent="Сохранить"}))}));var j=w.querySelector(".popup__button");R(P),D.addEventListener("click",(function(){N.value="",O.value="",i(P),p(P,q)}));var J=document.querySelector(".popup.popup_type_image"),M=J.querySelector(".popup__image"),H=J.querySelector(".popup__caption");function I(e){M.src=e.link,M.alt=e.name,H.textContent=e.name,i(J)}R(J);var V=document.querySelector(".popup.popup_type_delete-card");function z(e){e.preventDefault(),i(V)}function R(e){e.querySelector(".popup__close").addEventListener("click",(function(){d(e)}))}R(V),V.addEventListener("submit",(function(t){var o;t.preventDefault(),(o=r.id,fetch("".concat(e.baseUrl,"/cards/").concat(o),{method:"DELETE",headers:e.headers}).then(n)).then((function(){r.nodeDeleteBtn.closest(".card").remove(),d(V)})).catch((function(e){console.log("Ошибка удаления карточки: ".concat(e))}))}))})();